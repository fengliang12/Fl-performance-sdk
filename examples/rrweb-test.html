<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RRWeb é”™è¯¯æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            padding: 0;
        }

        h1 {
            text-align: center;
        }

        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ccc;
        }

        button {
            padding: 8px 16px;
            margin: 5px;
            cursor: pointer;
        }

        .log {
            background: #f5f5f5;
            padding: 10px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #ccc;
        }
    </style>
</head>

<body>
    <h1>RRWeb é”™è¯¯ç›‘æ§æµ‹è¯•</h1>
    <div class="test-section">
        <h3>é”™è¯¯è§¦å‘æµ‹è¯•</h3>
        <button onclick="triggerSyntaxError()">è¯­æ³•é”™è¯¯</button>
        <button onclick="triggerReferenceError()">å¼•ç”¨é”™è¯¯</button>
        <button onclick="triggerPromiseError()">Promiseé”™è¯¯</button>
        <button onclick="triggerNetworkError()">ç½‘ç»œé”™è¯¯</button>
    </div>

    <div class="test-section">
        <h3>æ—¥å¿—è¾“å‡º</h3>
        <div id="logOutput" class="log">ç­‰å¾…æ—¥å¿—è¾“å‡º...</div>
        <button onclick="clearLog()">æ¸…ç©ºæ—¥å¿—</button>
    </div>

    <!-- åŠ è½½æ€§èƒ½ SDK -->
    <script type="module">
        // å¯¼å…¥ Performance SDK
        import PerformanceMonitorSdk from '../dist/index.module.js';

        // åˆå§‹åŒ– SDKï¼Œå¯ç”¨ RRWeb å½•åˆ¶
        const sdk = new PerformanceMonitorSdk({
            elementTiming: true,
            resourceTiming: true,
            logUrl: "http://localhost:3000/api/error",
            captureError: true,
            rrwebConfig: {
                enabled: true,
                maxDuration: 10, // 30ç§’å½•åˆ¶æ—¶é•¿
                maxEvents: 300, // æœ€å¤§äº‹ä»¶æ•°é‡
                sampling: {
                    scroll: 100,
                    mousemove: 50,
                    input: 100
                }
            }
        });
        // å°† SDK å®ä¾‹æš´éœ²åˆ°å…¨å±€ï¼Œæ–¹ä¾¿æµ‹è¯•
        window.performanceSDK = sdk;
    </script>

    <script>
        // æ—¥å¿—è¾“å‡ºå‡½æ•°
        window.logToOutput = function (message) {
            const logDiv = document.getElementById('logOutput');
            const timestamp = new Date().toLocaleTimeString();
            logDiv.innerHTML += `[${timestamp}] ${message}\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
        };

        // é‡å†™ console.log ä»¥æ˜¾ç¤ºåœ¨é¡µé¢ä¸Š
        const originalLog = console.log;
        console.log = function (...args) {
            originalLog.apply(console, args);
            window.logToOutput('ğŸ“ ' + args.join(' '));
        };

        function triggerSyntaxError() {
            window.logToOutput('ğŸ”¥ è§¦å‘è¯­æ³•é”™è¯¯');
            setTimeout(() => {
                eval('var a = {');
            }, 100);
        }

        function triggerReferenceError() {
            window.logToOutput('ğŸ”¥ è§¦å‘å¼•ç”¨é”™è¯¯');
            setTimeout(() => {
                nonExistentFunction();
            }, 100);
        }

        function triggerPromiseError() {
            window.logToOutput('ğŸ”¥ è§¦å‘ Promise é”™è¯¯');
            setTimeout(() => {
                Promise.reject(new Error('æµ‹è¯• Promise é”™è¯¯'));
            }, 100);
        }

        function triggerNetworkError() {
            window.logToOutput('ğŸ”¥ è§¦å‘ç½‘ç»œé”™è¯¯');
            const script = document.createElement('script');
            script.src = 'https://non-existent-domain-12345.com/script.js';
            document.head.appendChild(script);
        }

        function clearLog() {
            document.getElementById('logOutput').innerHTML = 'æ—¥å¿—å·²æ¸…ç©º...\n';
        }

        // é¡µé¢åŠ è½½å®Œæˆ
        window.addEventListener('load', () => {
            window.logToOutput('ğŸ“„ é¡µé¢åŠ è½½å®Œæˆï¼ŒSDK å·²åˆå§‹åŒ–');
        });
    </script>
</body>

</html>